import{_ as E}from"./icon-BMzdE3NH.js";import{r,o as J,u as V,n as B,a as b,d as t,f as q,k as x,l as z,m as H,p as w,t as _,h,q as M,s as G,b as v}from"./index-BfHCVPAw.js";import{J as L}from"./json-show-7COQnYNj.js";const U={class:"w-full h-full"},P={class:"w-full h-full flex flex-col px-30 justify-center backdrop-blur-lg"},A={class:"flex flex-col h-2/3 mt-12"},I={class:"shadow-2xl w-full h-full bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden flex flex-col justify-between"},W={class:"border-t border-gray-200 bg-gray-50 px-4 py-3 flex items-center justify-between"},F={key:0,class:"flex items-center text-sm text-gray-600"},K={key:1,class:"text-sm text-gray-500"},Q={class:"flex space-x-4 ml-3 z-50"},X={class:"dropdown dropdown-top"},Y={tabindex:"0",class:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52 z-50 mb-2"},Z={class:"dropdown dropdown-top"},ee={tabindex:"0",class:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52 z-50 mb-2"},te=["disabled"],re={__name:"result",setup(oe){const d=r(null),p=r({ERROR:"获取失败"}),m=r(""),u=V(),k=G(),l=r(""),i=r(!1),c=r(null),g=async()=>{i.value=!0,l.value="";try{const e=(await fetch("/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({function_name:u.query.function_name,file_name:u.query.file_name,reference:u.query.reference})})).body.getReader(),s=new TextDecoder;for(;;){const{done:n,value:D}=await e.read();if(n)break;s.decode(D).split(`

`).forEach(y=>{y.startsWith("data: ")&&(l.value+=y.substring(6)+`
`)}),C()}}catch{l.value="生成失败，请重试"}finally{i.value=!1}},C=()=>{M(()=>{c.value&&(c.value.scrollTop=c.value.scrollHeight)})},f=()=>{i.value=!1},T=async()=>{try{await navigator.clipboard.writeText(l.value),alert("已复制到剪贴板")}catch(o){console.error("复制失败:",o),alert("复制失败，请手动选择文本复制")}},S=()=>{f(),g()},j=()=>{f(),k.go(-1)},R=r({ERROR:"获取失败"}),O=new Map([["/all_metainfo","查看全部元信息"],["/function_metainfo","函数元信息"],["/global_variable_metainfo","全局变量元信息"],["/udt_metainfo","UDT元信息"],["/testcase_metainfo","测试用例"],["/testcase_analysis_result","测试用例分析结果"],["/function_similarity","函数相似度"],["/context_analysis_result","上下文分析结果"]]),a=async o=>{let e;try{const s=await fetch(o,{method:"GET"});if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);e=await s.json(),console.log(e)}catch(s){console.error(`Error fetching ${o}$: `,s),e=R.value}m.value=O.get(o),$(e)},$=o=>{try{if(!o){console.warn("没有可显示的JSON数据");return}if(p.value=o,!d.value){console.error("JSON查看器组件未正确初始化");return}typeof d.value.open=="function"?d.value.open():console.error("JSON查看器缺少open方法")}catch(e){console.error("显示JSON查看器时出错:",e),alert("无法显示数据，请查看控制台获取详细信息")}},N=()=>{console.log("JSON查看器已关闭")};return J(()=>{u.query.function_name&&u.query.file_name?g():l.value="缺少必要的参数"}),B(f),(o,e)=>{const s=H("el-button");return v(),b("div",U,[t("div",P,[e[12]||(e[12]=q('<div class="absolute top-12 right-1/3 flex items-center justify-center"><div class="backdrop-blur-lg bg-white w-28 rounded-2xl mr-5 pr-2 mt-6"><img src="'+E+'" alt="LOGO" class="w-28"></div><h1 class="hidden xl:block text-md font-bold text-center pt-8 text-black">AeroTest</h1><h1 class="hidden md:block text-md font-bold text-center pt-8 text-black">航宇智测</h1></div>',1)),t("div",A,[x(s,{onClick:j,class:"shadow-2xl justify-left flex w-16 items-center text-gray-600 hover:text-gray-900 mb-4 transition-colors"},{default:z(()=>e[8]||(e[8]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z","clip-rule":"evenodd"})],-1),h(" 返回 ")])),_:1}),t("div",I,[t("div",{ref_key:"resultDisplay",ref:c,class:w(["p-4 md:p-6 min-h-[300px] overflow-y-auto whitespace-pre-wrap font-mono text-gray-800",{"animate-pulse":i.value&&!l.value}])},_(l.value||(i.value?"▍":"暂无生成结果...")),3),t("div",W,[i.value?(v(),b("div",F,e[9]||(e[9]=[t("div",{class:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mr-2"},null,-1),h(" 生成中... ")]))):(v(),b("div",K,_(l.value?"完成":"就绪"),1)),t("div",Q,[t("label",{onClick:e[0]||(e[0]=n=>a("/all_metainfo")),class:"btn bg-gray-100 text-gray-700 hover:bg-gray-200"}," 查看全部元信息 "),t("div",X,[e[10]||(e[10]=t("label",{tabindex:"0",class:"btn bg-gray-100 text-gray-700 hover:bg-gray-200"}," 查看构建元信息 ",-1)),t("ul",Y,[t("li",null,[t("a",{onClick:e[1]||(e[1]=n=>a("/function_metainfo"))},"函数元信息")]),t("li",null,[t("a",{onClick:e[2]||(e[2]=n=>a("/global_variable_metainfo"))},"全局变量元信息")]),t("li",null,[t("a",{onClick:e[3]||(e[3]=n=>a("/udt_metainfo"))},"UDT元信息")]),t("li",null,[t("a",{onClick:e[4]||(e[4]=n=>a("/testcase_metainfo"))},"测试用例")])])]),t("div",Z,[e[11]||(e[11]=t("label",{tabindex:"0",class:"btn bg-gray-100 text-gray-700 hover:bg-gray-200"}," 查看中间分析结果 ",-1)),t("ul",ee,[t("li",null,[t("a",{onClick:e[5]||(e[5]=n=>a("/testcase_analysis_result"))},"测试用例分析结果")]),t("li",null,[t("a",{onClick:e[6]||(e[6]=n=>a("/function_similarity"))},"函数相似度")]),t("li",null,[t("a",{onClick:e[7]||(e[7]=n=>a("/context_analysis_result"))},"上下文分析结果")])])]),t("button",{onClick:T,disabled:!l.value,class:w(["btn",l.value?"bg-blue-100 text-blue-700 hover:bg-blue-200":"bg-gray-100 text-gray-400 cursor-not-allowed"])}," 复制 ",10,te),t("button",{onClick:S,class:"btn bg-gray-100 text-gray-700 hover:bg-gray-200"}," 重新生成 ")]),x(L,{ref_key:"jsonViewerRef",ref:d,jsonData:p.value,title:m.value,onClose:N},null,8,["jsonData","title"])])])])])])}}};export{re as default};
